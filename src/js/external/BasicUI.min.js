function ClassCallback(t,e){return function(){return e.apply(t,arguments)}}var Class=function(){};!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var a=new this;t=!1;for(var o in i)a[o]="function"==typeof i[o]&&"function"==typeof s[o]&&e.test(i[o])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(o,i[o]):i[o];return n.prototype=a,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var Callback=ClassCallback,UserInterface=Class.extend({init:function(t){this.elements={},this.wayfinder=t,this.setWayfinderCallbacks(),this.loadingScreen=new LoadingScreen($("#loading-screen")),this.history=new History,this.logo=$("#logo"),this.settings={},this.maxInactivityTime=3e4,this.keyboard=null,this.lastTouch=-1,$(window).resize(ClassCallback(this,this.resize))},setWayfinderCallbacks:function(){this.wayfinder.cbOnPOIClick=ClassCallback(this,this.onMapPOIClick),this.wayfinder.cbOnDataLoaded=ClassCallback(this,this.onDataLoaded),this.wayfinder.cbOnProgress=ClassCallback(this,this.onProgress),this.wayfinder.cbOnStageProgress=ClassCallback(this,this.onStageProgress),this.wayfinder.cbOnLanguageChange=ClassCallback(this,this.onSetLanguage),this.wayfinder.cbOnBeforeFloorChange=ClassCallback(this,this.onBeforeFloorChange),this.wayfinder.cbOnFloorChange=ClassCallback(this,this.onFloorChange),this.wayfinder.cbOnZoomChange=ClassCallback(this,this.onZoomChange),this.wayfinder.cbOnMapUpdate=ClassCallback(this,this.onMapUpdate),this.wayfinder.cbOnMapReady=ClassCallback(this,this.onMapReady),this.wayfinder.cbOnPathStep=ClassCallback(this,this.onPathStep),this.wayfinder.onAssetsProgress=ClassCallback(this,this.onAssetsProgress)},onDataLoaded:function(){this.setup(),this.resize(),this.loadingScreen.hide(),this.setDocumentTitle()},setup:function(){this.loadTemplateSettings(),this.floorButtonsMenu=new FloorButtonsMenu($("#floors"),this.wayfinder.building.getFloors(),this),this.zoomSlider=new ZoomSlider($("#zoom"),this),this.wayfinder.settings.data["building.logo"]&&$("#logo").css("background-image","url('"+WayfinderAPI.getURL("images","get",[this.wayfinder.settings.data["building.logo"]])+"')"),this.wayfinder.translator.translate(),this.setupLanguage(),this.setupScreensaver(),this.setIdleTimer()},loadTemplateSettings:function(){this.settings.displayGroupPOIsOnMap=this.wayfinder.settings.getBoolean("template.default.display-group-pois-on-map",!0),this.settings.displayNearestPOI=this.wayfinder.settings.getBoolean("template.default.display-nearest-poi",!0)},onSetupFinished:function(){this.wayfinder.translator.translate(),this.loadingScreen.hide(),this.setupKeyboards()},setupLanguage:function(){var t=this.wayfinder.getLanguage();t&&this.wayfinder.languages[t]&&($("body").removeClass("rtl"),$("body").removeClass(function(t,e){return(e.match(/(^|\s)language_\S+/g)||[]).join(" ")}),$("body").addClass("language_"+this.wayfinder.languages[t].getName()),$("body").addClass(this.wayfinder.languages[t].getTextDirection()))},setupBanners:function(){function t(t){$("body").addClass("banner-"+t)}var e=this,i=this.wayfinder.advertisements;i&&Logistics.getJSON("layout.json",function(n){if(n.id in i){var s=[],a=i[n.id];for(var o in a){var h=$("#"+o);if(0!==h.length){var r=a[o];0!==r.length&&(s.push(new Banner(h,r)),r.length>0&&t(o))}}e.resize()}})},setIdleTimer:function(){function t(t){-1==e.lastTouch&&(e.hideScreensaver(),e.wayfinder.statistics.onSessionStart(),setTimeout(i,e.maxInactivityTime)),e.lastTouch=(new Date).getTime(),e.onBodyTouch(t)}this.wayfinder.settings.data["kiosk.max-inactivity"]&&(this.maxInactivityTime=1e3*parseInt(this.wayfinder.settings.data["kiosk.max-inactivity"],10));var e=this,i=function(){var t=(new Date).getTime();t-e.lastTouch>e.maxInactivityTime?e.lastTouch>-1?e.onTimeout():setTimeout(i,e.maxInactivityTime):setTimeout(i,e.maxInactivityTime-(t-e.lastTouch))};$("body").hammer().on("touch",t),setTimeout(i,this.maxInactivityTime),this.lastTouch=(new Date).getTime()},resize:function(){this.wayfinder.options.map.width($(window).width()).height($(window).height()),this.wayfinder.resize()},onProgress:function(t){this.loadingScreen.setProgress(t)},onAssetsProgress:function(t){this.loadingScreen.setStageProgress("frak",t)},onStageProgress:function(t,e){this.loadingScreen.setStageProgress(t,e)},onSetLanguage:function(t){this.setupLanguage(),this.wayfinder.onSetLanguage(t)},setupKeyboards:function(){if(this.keyboard){var t=this.wayfinder.languages;for(var e in t)this.loadKeyboardLayout(e)}},loadKeyboardLayout:function(t){var e=this;this.keyboard&&!this.keyboard.layouts[t]?Logistics.getJSON("../../../shared/json/keyboard/stripped/"+t+".json",function(i){e.keyboard&&i&&e.keyboard.addLayout(t,i)}):this.keyboard.changeLayout(t)},setDocumentTitle:function(){},onBeforeFloorChange:function(t,e,i){$("#notifications").text(this.wayfinder.translator.get("go_to_floor",[t.getName(this.wayfinder.getLanguage()),i.getName(this.wayfinder.getLanguage()),e.getName(this.wayfinder.getLanguage())])).show().delay(5e3).fadeOut()},onZoomChange:function(t){this.zoomSlider.setZoom(t)},onPathStep:function(){},displayPOIInfo:function(){},showPath:function(t){this.wayfinder.statistics.onClick(t.id,"route")},onFloorChange:function(){},setFloor:function(t){this.wayfinder.showFloor(t)},onFloorSelect:function(){},displayGroup:function(){},displayFloorPOIs:function(){},displayPOIsWithChar:function(){},onMapPOIClick:function(t){this.wayfinder.statistics.onClick(t.id,"map")},increaseZoom:function(){this.wayfinder.zoomIn()},decreaseZoom:function(){this.wayfinder.zoomOut()},setZoom:function(t){this.wayfinder.setZoom(t)},showUsersLocation:function(){},onMapUpdate:function(){},onMapReady:function(){},onTabActivate:function(){},setupScreensaver:function(){$("#screensaver").hammer().on("tap",ClassCallback(this,this.hideScreensaver))},showScreensaver:function(){this.wayfinder.screensaving||this.wayfinder.showScreensaver(),$("#screensaver").show(100)},hideScreensaver:function(){this.wayfinder.screensaving&&(this.lastTouch=(new Date).getTime(),this.wayfinder.hideScreensaver()),$("#screensaver").hide(100)},onTimeout:function(){this.lastTouch=-1,this.wayfinder.statistics.onSessionEnd(),this.wayfinder.restoreDefaultState(),this.showScreensaver()},onBodyTouch:function(){},panLeft:function(){this.wayfinder.orbitController.move(-1,0),console.log("panLeft")},panRight:function(){this.wayfinder.orbitController.move(1,0),console.log("panRight")},rotateUp:function(){this.wayfinder.orbitController.rotate(1,0),console.log("rotateUp")},rotateDown:function(){this.wayfinder.orbitController.rotate(-1,0),console.log("rotateDown")}}),History=Class.extend({init:function(){this.setup(),this.states=[]},setup:function(){window.onpopstate=ClassCallback(this,this.back)},write:function(t,e,i){this.states.push({open:t,close:e,name:i}),history&&history.pushState&&history.pushState({id:this.states.length-1},document.title,document.location),t&&"function"==typeof t&&t()},back:function(t){if(this.states.length>0){var e=this.states.pop();e&&e.close&&"function"==typeof e.close&&e.close(),this.states.length>0&&(e=this.states[this.states.length-1],e&&e.open&&"function"==typeof e.open&&e.open())}t.state&&this.onBack(t.state.id),0===this.states.length&&"function"==typeof this.onExit&&this.onExit()},onBack:function(){},onExit:function(){},clear:function(t){var e=t?t:0;this.states.length=e},triggerBack:function(){history.back()},callState:function(t){t&&this.states[t]&&"function"==typeof this.states[t]&&this.states[t]()}}),HistoryTree=Class.extend({init:function(t){this.setup(),this.states={},this.tree={},this.current=[],this.rootState=[],this.scope=t},setup:function(){window.onpopstate=ClassCallback(this,this.back)},setRootState:function(t,e){this.rootState=[t,e]},setTree:function(t){this.tree=t},setState:function(t,e,i,n){var s=!1;if(null!==this.hasLeaf(t,0))this.current.push(t),s=!0;else if(null!==this.hasLeaf(t,1))this.current.pop(),this.current.push(t),s=!0;else if(null!==this.hasLeaf(t,2))this.current.pop(),this.current.pop(),this.current.push(t),s=!0;else for(var a in this.tree)a==t&&(this.current=[a],s=!0);s&&(this.states[this.current.join(".")]=[e,i,n],this.callCurrent(),history&&history.pushState&&history.pushState({id:t},document.title,document.location))},hasLeaf:function(t,e){for(var i=this.tree,n=0;n<Math.max(0,this.current.length-e);n++)"object"==typeof i&&(i=i[this.current[n]]);for(var s in i)if(s===t)return i[s];return null},write:function(t,e){this.states.push({open:t,close:e}),history&&history.pushState&&history.pushState({id:this.states.length-1},document.title,document.location),t&&"function"==typeof t&&t()},getLast:function(){},back:function(){if(0===this.current.length&&"function"==typeof this.onExit)return void this.onExit();var t=this.current.slice(0,Math.max(this.current.length-1)),e=t.join(".");"undefined"!=typeof this.states[e]?(this.callState(e),this.current=t,this.onBack(t),"function"==typeof this.onStateChange&&this.onStateChange(this.states[e])):1==this.current.length&&(this.current.pop(),"function"==typeof this.rootState[0]&&(this.rootState[0](this.rootState[1],this.scope),"function"==typeof this.onStateChange&&this.onStateChange(this.rootState[0])))},getLastState:function(){var t=this.current.slice(0,Math.max(this.current.length-1)),e=t.join(".");return this.states[e]},onBack:function(){},onExit:function(){},onStateChange:function(){},clear:function(){this.current=[]},callCurrent:function(){var t=this.current.join(".");this.callState(t)},callState:function(t){"undefined"!=typeof this.states[t]&&"function"==typeof this.states[t][0]&&(this.states[t][0](this.states[t][1],this.scope),"function"==typeof this.onStateChange&&this.onStateChange(this.states[t]))}}),View=Class.extend({init:function(t,e){this.position=vec2.create(),this.contentSize=t,this.viewSize=e,this._maxPosition=vec2.create(),this._minPosition=vec2.create()},getViewPosition:function(){return this.position},getContentPosition:function(){return this.position},clampPosition:function(){vec2.sub(this._maxPosition,this.getViewSize(),this.getContentSize()),vec2.max(this._maxPosition,this._minPosition,this._maxPosition),this.position=this.clamp(this.position,vec2.create(),this._maxPosition)},setViewPosition:function(t){!isNaN(parseFloat(t[0]))&&isFinite(t[0])&&!isNaN(parseFloat(t[1]))&&isFinite(t[1])&&(this.position=t,this.clampPosition())},move:function(t){t&&this.setViewPosition(vec2.add(t,this.getViewPosition(),t))},setViewSize:function(t,e){this.viewSize=vec2.fromValues(t,e),this.clampPosition()},setContentSize:function(t,e){this.contentSize=vec2.fromValues(t,e),this.clampPosition()},isContentLonger:function(){return this.viewSize[1]<=this.contentSize[1]},isContentWider:function(){return this.viewSize[0]<=this.contentSize[0]},getContentSize:function(){return this.contentSize},getViewSize:function(){return this.viewSize},clamp:function(t,e,i){var n=vec2.clone(t);return vec2.max(n,n,e),vec2.min(n,n,i),n},getPercentagePosition:function(){return vec2.div(vec2.create(),this.position,this.viewSize)}}),UIComponent=Class.extend({init:function(t){this.element=t?t:$("<div></div>"),this.parent=null},hide:function(t){t?this.element.hide(t):this.element.hide(),this.onHide()},onHide:function(){},show:function(t){t?this.element.show(t):this.element.show(),this.onShow()},toggle:function(t){this.element.is(":visible")?this.hide(t):this.show()},onShow:function(){},resize:function(){},activate:function(){this.element.addClass("active"),this.onActivate(this)},onActivate:function(){},deactivate:function(){this.element.removeClass("active"),this.onDeactivate()},onDeactivate:function(){},remove:function(){this.element.remove()},update:function(){},addClass:function(t){this.element.addClass(t)},removeClass:function(t){this.element.removeClass(t)},addAttribute:function(t,e){this.element.attr(t,e)}}),UserMessage=Class.extend({init:function(t,e,i,n){this.wayfinder=i,this.type=e,this.key=t,this.callback=n,this.timeout=15e3,this.draw()},draw:function(){this.element=$("<div class='message "+this.type+"'></div>");this.wayfinder.translator.getLanguage();this.wayfinder.translator.translateElement(this.element,this.key),this.element.hammer().on("tap",ClassCallback(this,this.onClick)),setTimeout(ClassCallback(this,this.close),this.timeout),this.wayfinder.options.messages.append(this.element)},close:function(){var t=this.element;t&&(this.element.hide(200,function(){t.remove()}),delete this.element)},onClick:function(){this.close(),this.callback&&this.callback(this)}}),Scrollbar=UIComponent.extend({init:function(t,e,i){this.vertical="undefined"!=typeof i?!i:!0,this.position=0,this.containerSize=1,this.contentSize=1,this.onScroll=!1,this.parentElement=t,this.element=$("<div class='scrollbar "+e+"'></div>"),this.bar=$("<div class='bar'></div>"),this.element.append(this.bar),t.append(this.element),this._super(this.element),this.element.on("selectstart",!1),this.element.addClass("no-select"),this.mouseDelta=vec2.create(),this.element.hammer().on("drag",ClassCallback(this,this.onDrag)),this.element.hammer().on("dragend",ClassCallback(this,this.onEndDrag)),this.element.hammer().on("dragstart",ClassCallback(this,this.onStartDrag)),this.view=new View(vec2.fromValues(this.bar.width(),this.bar.height()),vec2.fromValues(this.element.innerWidth(),this.element.innerHeight()))},setup:function(t,e){this.contentSize=e,this.containerSize=t;var i=this.containerSize/this.contentSize;this.vertical?(this.element.height(t),this.bar.height(Math.max(5,Math.floor(t*i)))):(this.element.width(t),this.bar.width(Math.max(5,Math.floor(t*i)))),this.resize()},clear:function(){this.position=0,this.setPosition(0)},getBarLength:function(){return parseInt(this.vertical?this.bar.height():this.bar.width())},getViewLength:function(){return this.vertical?this.view.getViewSize()[1]:this.view.getViewSize()[0]},getContentLength:function(){return this.vertical?this.view.getContentSize()[1]:this.view.getContentSize()[0]},setPosition:function(t){Modernizr.csstransforms?this.bar.css(Modernizr.prefixed("transform"),"translate("+t[0]+"px,"+t[1]+"px)"):this.bar.css("left",t[0]+"px").css("top",t[1]+"px")},setContentPosition:function(t){var e=vec2.create(),i=this.containerSize/this.contentSize;vec2.scale(e,t,i),this.view.setViewPosition(e),this.setPosition(this.view.getContentPosition())},onStartDrag:function(t){t&&t.gesture&&(t.gesture.preventDefault(),t.gesture.stopPropagation())},onDrag:function(t){if(t&&t.gesture){t.gesture.preventDefault(),t.gesture.stopPropagation();var e=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY);this.view.move(vec2.negate(vec2.create(),vec2.sub(vec2.create(),this.mouseDelta,e))),this.mouseDelta=e,this.setPosition(this.view.getContentPosition()),this.onScroll&&"function"==typeof this.onScroll&&this.onScroll(this.getPercentage())}},onTap:function(t){if(t&&t.gesture){t.gesture.preventDefault(),t.gesture.stopPropagation();{vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY)}}},getPercentage:function(){var t=vec2.len(this.view.getViewPosition());return t/this.getViewLength()},onEndDrag:function(){this.mouseDelta=vec2.create()},resize:function(){this.view.setViewSize(parseInt(this.element.width()),parseInt(this.element.height())),this.view.setContentSize(parseInt(this.bar.width()),parseInt(this.bar.height())),this.getViewLength()<=this.getContentLength()||0==this.getViewLength()?this.hide():this.show()}}),DragScroll=Class.extend({init:function(t,e,i){this.options={smooth:!0,reverse:!0,swapContainers:!0,updateInterval:10,wheelSpeed:50},void 0!==i&&i&&(this.options=this.chooseOptions(this.options,i)),this.viewElement=t,this.contentElement=e,this.viewElement.addClass("scrollable-view"),this.contentElement.addClass("scrollable-content"),this.mouseDelta=vec2.create(),this.smoothDistance=null,this.timeout=null,this.updateCallback=!1,this.transformsSupported=this.isTransformSupported(),this.smoothCoeficent=vec2.fromValues(11,11),this._vec2cache=vec2.create(),this.positionClassNames="",this.view=this.getOption("swapContainers")?new View(vec2.fromValues(this.viewElement.width(),this.viewElement.height()),vec2.fromValues(this.contentElement.width(),this.contentElement.height())):new View(vec2.fromValues(this.contentElement.width(),this.contentElement.height()),vec2.fromValues(this.viewElement.width(),this.viewElement.height()));var n=this;$(window).resize(function(){n.resize()}),this.viewElement.hammer().on("dragstart",function(t){t&&t.gesture&&(t.gesture.preventDefault(),t.gesture.stopPropagation()),n.onStartDrag(),n.stop()}),this.viewElement.hammer().on("tap",function(t){t.gesture.preventDefault()}),this.viewElement.hammer().on("drag",ClassCallback(this,this.onDrag)),this.viewElement.hammer().on("dragend",ClassCallback(this,this.onEndDrag)),this.viewElement.bind("mousewheel",function(t){var e=0;t.originalEvent&&(t=t.originalEvent),e="wheelDelta"in t?t.wheelDelta<0?1:t.wheelDelta>0?-1:1:t.deltaY>0?1:t.deltaY<0?-1:1,n.scroll(vec2.fromValues(0,n.getOption("wheelSpeed")*e))})},chooseOptions:function(t,e){for(var i in e)t[i]&&(t[i]=e[i]);return t},getOption:function(t){return this.options[t]},setOption:function(t,e){this.options[t]=e},setSmoothScrolling:function(t){this.setOption("smooth",t)},setDirection:function(t){this.setOption("reverse",t)},onStartDrag:function(){},onDrag:function(t){if(t&&t.gesture&&-1==t.gesture.target.className.search("bar")&&(t.gesture.preventDefault(),t.gesture.stopPropagation(),!this.scrolling)){this.scrolling=!0;var e=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY);this.scroll(this.getOption("reverse")?vec2.subtract(vec2.create(),this.mouseDelta,e):vec2.subtract(vec2.create(),e,this.mouseDelta)),this.mouseDelta=e}},scroll:function(t){var e=this;this.timeout=requestAnimFrame(function(){e.view.move(t),t=vec2.clone(e.view.getContentPosition()),e.setContentOffset(t),e.updateCallback&&"function"==typeof e.updateCallback&&e.updateCallback(e)},0)},reset:function(){this.setScroll(vec2.create())},setScroll:function(t){this.view.setViewPosition(t),this.setContentOffset(this.view.getContentPosition())},resize:function(){this.getOption("swapContainers")?(this.view.setViewSize(parseInt(this.contentElement.innerWidth()),parseInt(this.contentElement.innerHeight())),this.view.setContentSize(parseInt(this.viewElement.width()),parseInt(this.viewElement.height()))):(this.view.setViewSize(parseInt(this.viewElement.innerWidth()),parseInt(this.viewElement.innerHeight())),this.view.setContentSize(parseInt(this.contentElement.width()),parseInt(this.contentElement.height()))),this.scroll(0),this.checkIfScrollIsNeeded()},setContentOffset:function(t){var e=1;this.getOption("swapContainers")&&(e=-1),this.transformsSupported!==!1?this.contentElement.css(this.transformsSupported+"transform","translate("+t[0]*e+"px,"+t[1]*e+"px)"):this.contentElement.css("left",t[0]*e+"px").css("top",t[1]*e+"px"),this.scrolling=!1,this.checkContentPosition()},stop:function(){this.mouseDelta=vec2.create(),this.timeout&&cancelAnimationFrame(this.timeout)},onEndDrag:function(t){if(void 0!==t&&"dragend"===t.type&&t.gesture){t.gesture.preventDefault();var e=vec2.fromValues(t.gesture.velocityX,t.gesture.velocityY);if(this.getOption("smooth")&&vec2.sqrLen(e)>.3){var i=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY),n=vec2.create();vec2.multiply(n,i,e);var s=this;this.stop();var a=vec2.create(),o=function(){vec2.div(a,n,s.smoothCoeficent),vec2.sqrLen(a)>3&&(vec2.sub(n,n,a),requestAnimFrame(o,s.getOption("updateInterval")),vec2.negate(a,a),s.scroll(a))};this.timeout=requestAnimFrame(o,s.updateInterval)}}},setUpdateCallback:function(t){this.updateCallback=t},setRelativePosition:function(t){var e=vec2.create();vec2.scale(e,vec2.sub(e,this.view.getViewSize(),this.view.getContentSize()),t),this.setScroll(e)},getRelativePosition:function(){return vec2.div(this._vec2cache,this.view.getViewPosition(),vec2.sub(this._vec2cache,this.view.getViewSize(),this.view.getContentSize())),this._vec2cache},checkIfScrollIsNeeded:function(){this.view.isContentLonger()&&this.viewElement.addClass("content-longer"),this.view.isContentWider()&&this.viewElement.addClass("content-wider")},checkContentPosition:function(){var t=this.getRelativePosition(),e=[];0===t[0]&&e.push("on-left"),0===t[1]&&e.push("on-top"),1===t[0]&&e.push("on-right"),1===t[1]&&e.push("on-bottom"),e=e.join(" "),e!==this.positionClassNames&&(this.viewElement.removeClass(this.positionClassNames),this.viewElement.addClass(e),this.positionClassNames=e)},isTransformSupported:function(){for(var t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],e=document.createElement("div"),i=["","-webkit-","-moz-","-o-","-ms-"],n=0;n<t.length;n++)if(e&&void 0!==e.style[t[n]])return i[n];return!1}});window.requestAnimFrame=function(t,e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,e)}}(),function(){window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var ScrollableComponent=UIComponent.extend({init:function(t){this.viewElement=t,this.viewElement.addClass("scrollable-view"),this.scrollbar=!1,this.contentElement=this.viewElement.find(".scrollable-content"),this.contentElement[0]||(this.contentElement=$("<div class='scrollable-content no-select'></div>"),this.viewElement.append(this.contentElement)),this._super(this.contentElement),this.dragScroll=new DragScroll(this.viewElement,this.contentElement)},addScrollbar:function(){this.scrollbar=new Scrollbar(this.viewElement,"right"),this.scrollbar.setup(parseInt(this.viewElement.height()),parseInt(this.contentElement.height())),this.viewElement.addClass("hasScrollbar"),this.dragScroll.setUpdateCallback(ClassCallback(this,this.updateScrollbar)),this.scrollbar.onScroll=ClassCallback(this,this.updateScrollContainer)},updateScrollbar:function(t){this.scrollbar.setContentPosition(t.view.getContentPosition())},updateScrollContainer:function(t){this.dragScroll.setScroll(vec2.scale(vec2.create(),this.dragScroll.view.viewSize,t))},show:function(){this.viewElement.show(),this.onShow()},hide:function(){this.viewElement.hide(),this.onHide()},resize:function(){this.dragScroll.resize(),this.scrollbar&&(this.scrollbar.setup(parseInt(this.viewElement.height()),parseInt(this.contentElement.height())),this.scrollbar.resize(),parseInt(this.viewElement.height())<parseInt(this.contentElement.height())?(this.viewElement.addClass("hasScrollbar"),this.scrollbar.show()):(this.viewElement.removeClass("hasScrollbar"),this.scrollbar.hide()))},reset:function(){this.dragScroll.resize(),this.dragScroll.reset()},activate:function(){this._super(),this.resize()},update:function(){this.resize()}}),Button=UIComponent.extend({init:function(t,e,i){this._super(t),this.title=e,this.callback=i,this.setTitle(e),this.element.hammer().on("tap",ClassCallback(this,this.onClick))},setTitle:function(t){this.title=t,this.element.text(t)},onClick:function(t){this.callback&&"function"==typeof this.callback&&(t.gesture.stopPropagation(),this.callback(t))}}),PathStepper=UIComponent.extend({init:function(t,e){this._super(t),this.ui=e,this.prevInstructionButton=t.find("#last-instr"),this.prevInstructionButton.hammer().on("tap",ClassCallback(this,this.prevInstruction)),this.nextInstructionButton=t.find("#next-instr"),this.nextInstructionButton.hammer().on("tap",ClassCallback(this,this.nextInstruction)),this.notificationArea=t.find("#notifications"),this.path=!1,this.currentInstruction=0},setPath:function(t){console.log("PathStepper",t),this.clear(),this.path=t,this.path&&this.path.steps&&this.displayStep(t.steps[this.currentInstruction])},prevInstruction:function(){if(this.path&&this.path.steps){this.currentInstruction>0&&this.currentInstruction--;var t=this.path.steps[this.currentInstruction];this.displayStep(t),this.ui.wayfinder.zoomOnPathSegment(t.endNode,t.startNode)}},nextInstruction:function(){if(this.path&&this.path.steps){this.currentInstruction<this.path.steps.length-1&&this.currentInstruction++;var t=this.path.steps[this.currentInstruction];this.displayStep(t),this.ui.wayfinder.zoomOnPathSegment(t.endNode,t.startNode)}},displayStep:function(t){var e=this.ui.wayfinder.translator,i="";if(t.walk&&(i+=e.get("path-walk",[t.walk]),i+="<br />"),t.turn&&(i+=e.get("path-turn-"+t.turn),i+="<br />"),t.use&&(i+=e.get("path-use-"+t.use),i+="<br />"),t.landmark&&t.landmark.length>0&&(i+=e.get("path-landmark",[t.landmark[0].getName(this.ui.wayfinder.getLanguage())]),i+="<br />"),t.go_to_floor){var n=this.ui.wayfinder.building.floors[t.go_to_floor].getName(this.ui.wayfinder.getLanguage());i+=e.get("path-go-to-floor",[n])}this.notificationArea.html(i),this.notificationArea.show()},clear:function(){this.path=!1,this.currentInstruction=0,this.notificationArea.text(""),this.notificationArea.hide()},pathStep:function(t){if(this.path&&this.path.steps)for(var e=0;e<this.path.steps.length-1;e++)if(this.path.steps[e].startNode&&this.path.steps[e].startNode.id==t.id){this.displayStep(this.path.steps[e+1]),this.currentInstruction=e+1;break}}}),Menu=UIComponent.extend({init:function(t){this.element=t,this.element.addClass("no-select"),this.items=[],this.cache=[],this.active=!1,this.activateTimer=null},add:function(t){return this.items.push(t),t.onAdd(this),this.addItemElement(t),this.addCallback(t),t},prepend:function(t){return this.items.push(t),t.onAdd(this),this.prependItemElement(t),this.addCallback(t),t},addItemElement:function(t){this.cache.push(t.element)},prependItemElement:function(t){this.cache.unshift(t.element)},publish:function(){this.element.empty().append(this.cache),this.cache=[]},addCallback:function(t){var e=this;t.element&&t.element.hammer&&(t.element.hammer().on("tap",function(i){function n(){t.callback&&"function"==typeof t.callback&&t.callback(t),e.onItemClick(t,i),e.activateItem(t),t.onClick()}i.gesture.stopPropagation(),i.gesture.preventDefault(),t!==e.active?n():(cancelAnimationFrame(this.activateFrame),this.activateFrame=requestAnimFrame(n))}),t.element.hammer().on("touchstart",function(){t.element.addClass("tapped")}),t.element.hammer().on("touchend",function(){t.element.removeClass("tapped")}))},activateItem:function(t){this.active!=t&&(this.deactivateAll(t),this.active=t,this.active&&this.active.activate(this))},deactivateAll:function(t){this.active&&this.active!==t&&(this.active.deactivate(this),this.active=!1)},activateItemWithObject:function(t){for(var e in this.items)if(this.items[e].dataObject==t)return void this.activateItem(this.items[e])},triggerItemWithObject:function(t){for(var e in this.items)if(this.items[e].dataObject==t)return this.activateItem(this.items[e]),void this.onItemClick(this.items[e])},onItemClick:function(){},clear:function(){this.active=!1;for(var t=0;t<this.items.length;t++)this.items[t].remove();this.items.length=0,this.element.empty()},onSetLanguage:function(){this.resize()},sort:function(t){this.items.sort(function(e,i){return e.less(i,t)?-1:i.less(e,t)?1:0}),this.element.empty();for(var e in this.items)this.addItemElement(this.items[e]),this.addCallback(this.items[e])}}),MenuItem=UIComponent.extend({init:function(t){this.label=t,this.callback=!1,this.dataObject=!1,this.element=!1,this.createElement()},setCallback:function(t){t&&"function"==typeof t&&(this.callback=t)},getCallback:function(){return this.callback},getDataObject:function(){return this.dataObject},setDataObject:function(t){this.dataObject=t},createElement:function(){var t=document.createElement("div");t.className="item",t.innerHTML=this.label,this.element=$(t),this.element.on("touchmove",function(t){t.preventDefault()}),this.element.on("selectstart",!1)},getLabel:function(){return this.label},onClick:function(){},onAdd:function(){},less:function(t){return this.element.text()<t.element.text()}}),BulletItem=MenuItem.extend({init:function(t){this._super(t)},createElement:function(){this.element=$("<div class='item bullet "+this.label+"'>"+this.label+"</div>"),this.bullet=$("<div class='bullet'></div>"),this.element.prepend(this.bullet),this.element.bind("touchmove",function(t){t.preventDefault()})},setBulletColor:function(t){this.bullet&&(this.bullet.css("background-color",t.toString()),this.bullet.css("color",t.toString()))}}),ValueMenuItem=MenuItem.extend({init:function(t,e){this.value=e,this.valueElement=null,this.nameElement=null,this._super(t)},createElement:function(){var t=document.createElement("div");t.className="item",this.element=$(t);var e=document.createElement("div");e.setAttribute("name","name"),e.innerHTML=this.label,this.nameElement=$(e);var i=document.createElement("div");i.setAttribute("name","value"),i.innerHTML=this.value,this.valueElement=$(i),this.element.append([this.nameElement,this.valueElement]),this.element.bind("touchmove",function(t){t.preventDefault()})},getNameElement:function(){return this.nameElement},getValueElement:function(){return this.valueElement}}),TextInputItem=MenuItem.extend({init:function(t,e){this.input=!1,this.valueChangeCallback=e,this.lastKeyPress=-1,this.isDefaultValue=!0,this.timeout=null,this.wait=500,this._super(t),this.setValue(t)},createElement:function(){this.element=$("<div class='item searchitem'></div>"),this.input=$("<input type='text' data-label='"+this.label+"'/>"),this.element.append(this.input)},onAdd:function(){this.input.keyup(ClassCallback(this,this.onChange))},onClick:function(){this.input.val()==this.input.attr("data-label")&&this.input.val(""),this.lastKeyPress=-1},getValue:function(){return this.input.val()},setValue:function(t){this.input.val(t)},checkLastKeyPress:function(){var t=(new Date).getTime();this.isDefaultValue=!1,this.lastKeyPress&&this.lastKeyPress-t>-this.wait?(clearTimeout(this.timeout),this.timeout=setTimeout(ClassCallback(this,this.checkLastKeyPress),this.wait)):this.lastKeyPress>0&&(this.lastKeyPress=-1,clearTimeout(this.timeout),this.callValueChange())},onChange:function(){var t=(new Date).getTime();clearTimeout(this.timeout),this.timeout=setTimeout(ClassCallback(this,this.checkLastKeyPress),this.wait),this.lastKeyPress=t},callValueChange:function(){this.valueChangeCallback&&"function"==typeof this.valueChangeCallback&&this.getValue()!=this.input.attr("data-label")&&this.valueChangeCallback(this.getValue())},onDeactivate:function(){""===this.input.val()&&this.reset()},update:function(){""===this.input.val()&&this.input.val(this.input.attr("data-label"))},reset:function(){this.input.val(this.input.attr("data-label")),this.isDefaultValue=!0,this.input.blur()}}),ImageMenuItem=MenuItem.extend({init:function(t){this.imageId=!1,this.iconElement=!1,this.textElement=!1,this._super(t)},getInnerElement:function(){return this.innerElement},loadImage:function(t){this.imageId=t,this.imageId>0&&Logistics.getImage(WayfinderAPI.getURL("images","thumbnail",[this.imageId]),ClassCallback(this,function(t){this.iconElement.css("background-image","url('"+t.src+"')"),this.element.addClass("hasIcon")}))},createElement:function(){this.element=$("<div class='item'></div>"),this.iconElement=$("<div class='icon'></div>"),this.textElement=$("<div class='label'>"+this.label+"</div>"),this.element.append(this.iconElement),this.element.append(this.textElement),this.element.bind("touchmove",function(t){t.preventDefault()})}}),ScrollableMenu=Menu.extend({init:function(t){this.viewElement=t,this.viewElement.addClass("scrollable-view"),this.scrollbar=!1,this.contentElement=this.viewElement.find(".scrollable-content"),this.contentElement[0]||(this.contentElement=$("<div class='scrollable-content'></div>"),this.viewElement.append(this.contentElement)),this._super(this.contentElement),this.dragScroll=new DragScroll(this.viewElement,this.contentElement)},addScrollbar:function(){this.scrollbar=new Scrollbar(this.viewElement,"right"),this.scrollbar.setup(parseInt(this.viewElement.height()),parseInt(this.contentElement.height())),this.viewElement.addClass("hasScrollbar"),
this.dragScroll.setUpdateCallback(ClassCallback(this,this.updateScrollbar)),this.scrollbar.onScroll=ClassCallback(this,this.updateScrollContainer)},updateScrollbar:function(t){this.scrollbar.setContentPosition(t.view.getContentPosition())},updateScrollContainer:function(t){this.dragScroll.setScroll(vec2.scale(vec2.create(),this.dragScroll.view.viewSize,t))},show:function(){this.viewElement.show(),this.onShow()},hide:function(){this.viewElement.hide(),this.onHide()},resize:function(){this.dragScroll.resize(),this.scrollbar&&(this.scrollbar.setup(parseInt(this.viewElement.height()),parseInt(this.contentElement.height())),this.scrollbar.resize(),parseInt(this.viewElement.height())<parseInt(this.contentElement.height())?(this.viewElement.addClass("hasScrollbar"),this.scrollbar.show()):(this.viewElement.removeClass("hasScrollbar"),this.scrollbar.hide()))},reset:function(){this.dragScroll.resize(),this.dragScroll.reset()},activate:function(){this._super(),this.resize()},update:function(){this.resize()},publish:function(){this._super(),this.reset()}}),MultiValueMenuItem=MenuItem.extend({init:function(){this.values=[],this.elements=[];for(var t=0;t<arguments.length;t++)"string"==typeof arguments[t]&&this.values.push(arguments[t]);var e="";this.values[0]&&(e=this.values[0]),this._super(e)},createElement:function(){var t=document.createElement("div");t.className="item multivalueitem",this.element=$(t);for(var e=null,i=null,n=0;n<this.values.length;n++)e=document.createElement("div"),e.className="val-"+n,i=document.createTextNode(this.values[n]),e.appendChild(i),this.element.append($(e)),this.elements.push(e);this.element.bind("touchmove",function(t){t.preventDefault()})},getElement:function(){return this.nameElement}}),StaticMenuItem=MenuItem.extend({init:function(t,e){this._super(e),this.element=t,this.createElement()},createElement:function(){this.element.bind("touchmove",function(t){t.preventDefault()})},update:function(){}}),SubMenuItem=MenuItem.extend({init:function(t,e){this.menu=e,this.menuElement=!1,this.nameElement=!1,this._super(t)},addMenu:function(t){this.menu=t,this.menu&&this.menu.hide()},getMenu:function(){return this.menu},createElement:function(){var t=document.createElement("div");t.className="submenuitem item",this.element=$(t);var e=document.createElement("div");e.className="label",e.innerHTML=this.label,this.nameElement=$(e);var i=document.createElement("div");i.className="submenu menu",this.menuElement=$(i),this.element.append([this.nameElement,this.menuElement]),this.element.bind("touchmove",function(t){t.preventDefault()})},onActivate:function(){this.menu&&!this.menu.isActive()?(this.menu.show(),this.menu.activate()):(this.menu.hide(),this.menu.deactivate())},onDeactivate:function(){this.menu&&(this.menu.hide(),this.menu.deactivate())}}),LoadingScreen=UIComponent.extend({init:function(t,e){this._super(t),this.element=t,this.stages=e?e:[],this.tabs=!1,this.progress=0},setProgress:function(t){this.progress=Math.max(Math.min(parseInt(100*t),100),0),this.element&&this.element.find(".progress").one().css("width",this.progress+"%")},setStageProgress:function(t,e){this.element.find(".stage."+t).find(".bar").css("width",100*e+"%")},onLoadingDone:function(){}}),Tab=Class.extend({init:function(t,e,i){this.name=t,e&&e instanceof UIComponent&&(this.panel=e),i&&i instanceof UIComponent&&(this.button=i)},update:function(){this.panel.update(),this.button&&this.button.update()},getPanel:function(){return this.panel},getButton:function(){return this.button},remove:function(){},show:function(){this.panel.show(),this.button&&this.button.activate()},hide:function(){this.panel.hide(),this.button&&this.button.deactivate()},activate:function(){this.panel&&this.panel.activate(),this.button&&this.button.activate()},deactivate:function(){this.panel&&this.panel.deactivate(),this.button&&this.button.deactivate()},restore:function(){this.panel&&this.panel.show(this)},resize:function(){this.panel&&this.panel.resize(),this.button&&this.button.resize()}}),Tabs=Menu.extend({init:function(t){this._super(t),this.tabs=[],this.activeTab=!1},add:function(t,e,i){return this.tabs[t]=new Tab(t,e,i),i&&this._super(i),this.tabs[t]},removeTab:function(t){for(var e in this.tabs)if(this.tabs[e]==t)return this.tabs.splice(e,1),void this.tabs[e].remove(this)},getTab:function(t){return this.tabs[t]},activate:function(t){if(t instanceof UIComponent)for(var e in this.tabs)this.tabs[e]==t&&this.activateTab(e)},activateTab:function(t){var e=this.getTab(t);e&&(this.activeTab&&this.activeTab!==e&&(this.activeTab.hide(this),this.activeTab.deactivate()),this.activeTab=e,this.activeTab.show(this),this.activeTab.activate(),this.onActivate(this.activeTab,t))},restoreTab:function(t){var e=this.getTab(t);e&&(this.activeTab&&this.activeTab!==e&&(this.activeTab.hide(this),this.activeTab.deactivate()),this.activeTab=e,this.activeTab.show(this),this.activeTab.activate())},resize:function(){this._super();for(var t in this.tabs)this.tabs[t].resize()},update:function(){for(var t in this.tabs)this.tabs[t].update()}});